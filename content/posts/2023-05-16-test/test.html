---
title: "test"
output: html_document
date: "2023-05-10"
categories: ["Tidymodels"]
tags: ["Packages"]
---



<div id="observational-studies-and-propensity-score" class="section level1">
<h1>1. Observational studies and propensity score ⚖️</h1>
<ul>
<li>Conceptual stage</li>
<li>Design stage</li>
<li>Statistical analysis</li>
<li>Summary</li>
</ul>
<div id="conceptual" class="section level2">
<h2>Conceptual</h2>
<p>Formulation of the causal question and assumptions using potential
outcomes. Formulated as a randomized experiment.</p>
</div>
<div id="design-stage" class="section level2">
<h2>Design stage</h2>
<p>Reconstruct or approximate the design of a randomized experiment
(independence between treatment assignment and covariates). Needs to
conduct balance diagnostic.</p>
</div>
<div id="statistical-analysis" class="section level2">
<h2>Statistical analysis</h2>
<p>Compare outcomes by treatment. This stage is similar to the standard
model-based analysis.</p>
</div>
<div id="summary" class="section level2">
<h2>Summary</h2>
<p>Conclusion based on your estimates.</p>
<pre class="r"><code>library(tidyverse) # data manipulation
library(skimr) # Good for descriptive analysis 
library(tidymodels) # modeling
library(gt)  # To create pretty tables
library(table1) # To create pretty tables
tidymodels_prefer() # to avoid problems with two functions with the same name</code></pre>
</div>
<div id="conceptual-stage" class="section level2">
<h2>1. Conceptual stage</h2>
<blockquote>
<p>What is the effect of alcohol consumption on marihuana use?</p>
</blockquote>
<div id="dataset" class="section level3">
<h3>Dataset</h3>
<p>Selected data from YRBS</p>
<pre class="r"><code>#load(&quot;Causal_inference/small_data.rda&quot;)
load(&quot;small_data.rda&quot;)

small_data  |&gt; skimr::skim()</code></pre>
<table>
<caption><span id="tab:load-data">Table 1: </span>Data summary</caption>
<tbody>
<tr class="odd">
<td align="left">Name</td>
<td align="left">small_data</td>
</tr>
<tr class="even">
<td align="left">Number of rows</td>
<td align="left">31367</td>
</tr>
<tr class="odd">
<td align="left">Number of columns</td>
<td align="left">16</td>
</tr>
<tr class="even">
<td align="left">_______________________</td>
<td align="left"></td>
</tr>
<tr class="odd">
<td align="left">Column type frequency:</td>
<td align="left"></td>
</tr>
<tr class="even">
<td align="left">character</td>
<td align="left">2</td>
</tr>
<tr class="odd">
<td align="left">factor</td>
<td align="left">2</td>
</tr>
<tr class="even">
<td align="left">numeric</td>
<td align="left">12</td>
</tr>
<tr class="odd">
<td align="left">________________________</td>
<td align="left"></td>
</tr>
<tr class="even">
<td align="left">Group variables</td>
<td align="left">None</td>
</tr>
</tbody>
</table>
<p><strong>Variable type: character</strong></p>
<table>
<colgroup>
<col width="19%" />
<col width="13%" />
<col width="19%" />
<col width="5%" />
<col width="5%" />
<col width="8%" />
<col width="12%" />
<col width="15%" />
</colgroup>
<thead>
<tr class="header">
<th align="left">skim_variable</th>
<th align="right">n_missing</th>
<th align="right">complete_rate</th>
<th align="right">min</th>
<th align="right">max</th>
<th align="right">empty</th>
<th align="right">n_unique</th>
<th align="right">whitespace</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="left">district</td>
<td align="right">0</td>
<td align="right">1</td>
<td align="right">5</td>
<td align="right">12</td>
<td align="right">0</td>
<td align="right">13</td>
<td align="right">0</td>
</tr>
<tr class="even">
<td align="left">state</td>
<td align="right">0</td>
<td align="right">1</td>
<td align="right">2</td>
<td align="right">2</td>
<td align="right">0</td>
<td align="right">8</td>
<td align="right">0</td>
</tr>
</tbody>
</table>
<p><strong>Variable type: factor</strong></p>
<table>
<colgroup>
<col width="18%" />
<col width="12%" />
<col width="18%" />
<col width="10%" />
<col width="11%" />
<col width="28%" />
</colgroup>
<thead>
<tr class="header">
<th align="left">skim_variable</th>
<th align="right">n_missing</th>
<th align="right">complete_rate</th>
<th align="left">ordered</th>
<th align="right">n_unique</th>
<th align="left">top_counts</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="left">alcohol</td>
<td align="right">1718</td>
<td align="right">0.95</td>
<td align="left">FALSE</td>
<td align="right">2</td>
<td align="left">Yes: 15746, No: 13903</td>
</tr>
<tr class="even">
<td align="left">marijuana</td>
<td align="right">700</td>
<td align="right">0.98</td>
<td align="left">FALSE</td>
<td align="right">2</td>
<td align="left">No: 19351, Yes: 11316</td>
</tr>
</tbody>
</table>
<p><strong>Variable type: numeric</strong></p>
<table style="width:100%;">
<colgroup>
<col width="17%" />
<col width="12%" />
<col width="17%" />
<col width="9%" />
<col width="6%" />
<col width="6%" />
<col width="6%" />
<col width="6%" />
<col width="6%" />
<col width="6%" />
<col width="7%" />
</colgroup>
<thead>
<tr class="header">
<th align="left">skim_variable</th>
<th align="right">n_missing</th>
<th align="right">complete_rate</th>
<th align="right">mean</th>
<th align="right">sd</th>
<th align="right">p0</th>
<th align="right">p25</th>
<th align="right">p50</th>
<th align="right">p75</th>
<th align="right">p100</th>
<th align="left">hist</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="left">year</td>
<td align="right">0</td>
<td align="right">1.00</td>
<td align="right">2018.04</td>
<td align="right">1.00</td>
<td align="right">2017</td>
<td align="right">2017</td>
<td align="right">2019</td>
<td align="right">2019</td>
<td align="right">2019</td>
<td align="left">▇▁▁▁▇</td>
</tr>
<tr class="even">
<td align="left">age</td>
<td align="right">0</td>
<td align="right">1.00</td>
<td align="right">5.00</td>
<td align="right">1.23</td>
<td align="right">1</td>
<td align="right">4</td>
<td align="right">5</td>
<td align="right">6</td>
<td align="right">7</td>
<td align="left">▁▂▆▆▇</td>
</tr>
<tr class="odd">
<td align="left">sex</td>
<td align="right">0</td>
<td align="right">1.00</td>
<td align="right">0.54</td>
<td align="right">0.50</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">1</td>
<td align="right">1</td>
<td align="right">1</td>
<td align="left">▇▁▁▁▇</td>
</tr>
<tr class="even">
<td align="left">q30</td>
<td align="right">0</td>
<td align="right">1.00</td>
<td align="right">0.82</td>
<td align="right">0.39</td>
<td align="right">0</td>
<td align="right">1</td>
<td align="right">1</td>
<td align="right">1</td>
<td align="right">1</td>
<td align="left">▂▁▁▁▇</td>
</tr>
<tr class="odd">
<td align="left">q50</td>
<td align="right">0</td>
<td align="right">1.00</td>
<td align="right">0.03</td>
<td align="right">0.18</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">1</td>
<td align="left">▇▁▁▁▁</td>
</tr>
<tr class="even">
<td align="left">q51</td>
<td align="right">0</td>
<td align="right">1.00</td>
<td align="right">0.06</td>
<td align="right">0.23</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">1</td>
<td align="left">▇▁▁▁▁</td>
</tr>
<tr class="odd">
<td align="left">q52</td>
<td align="right">0</td>
<td align="right">1.00</td>
<td align="right">0.01</td>
<td align="right">0.12</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">1</td>
<td align="left">▇▁▁▁▁</td>
</tr>
<tr class="even">
<td align="left">q53</td>
<td align="right">0</td>
<td align="right">1.00</td>
<td align="right">0.02</td>
<td align="right">0.13</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">1</td>
<td align="left">▇▁▁▁▁</td>
</tr>
<tr class="odd">
<td align="left">q54</td>
<td align="right">0</td>
<td align="right">1.00</td>
<td align="right">0.03</td>
<td align="right">0.16</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">1</td>
<td align="left">▇▁▁▁▁</td>
</tr>
<tr class="even">
<td align="left">q55</td>
<td align="right">0</td>
<td align="right">1.00</td>
<td align="right">0.02</td>
<td align="right">0.14</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">1</td>
<td align="left">▇▁▁▁▁</td>
</tr>
<tr class="odd">
<td align="left">q56</td>
<td align="right">0</td>
<td align="right">1.00</td>
<td align="right">0.02</td>
<td align="right">0.13</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">1</td>
<td align="left">▇▁▁▁▁</td>
</tr>
<tr class="even">
<td align="left">q57</td>
<td align="right">227</td>
<td align="right">0.99</td>
<td align="right">0.73</td>
<td align="right">0.45</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">1</td>
<td align="right">1</td>
<td align="right">1</td>
<td align="left">▃▁▁▁▇</td>
</tr>
</tbody>
</table>
</div>
<div id="demographic-variables" class="section level3">
<h3>Demographic variables</h3>
<ul>
<li>Age</li>
<li>Sex</li>
</ul>
</div>
<div id="outcome" class="section level3">
<h3>Outcome</h3>
<ul>
<li><p>Q46. How old were you when you tried marijuana for the first
time? A. I have never tried marijuana B. 8 years old or younger C. 9
or 10 years old D. 11 or 12 years old E. 13 or 14 years old F. 15 or
16 years old G. 17 years old or older</p></li>
<li><p>marijuana: recoded as 0 (never used) 1 (used)</p></li>
</ul>
</div>
<div id="alcohol-use-treatment" class="section level3">
<h3>Alcohol use (“Treatment”)</h3>
<ul>
<li><p>Q40. How old were you when you had your first drink of alcohol other
than a few sips? A. I have never had a drink of alcohol other than a
few sips B. 8 years old or younger C. 9 or 10 years old D. 11 or 12
years old E. 13 or 14 years old F. 15 or 16 years old G. 17 years
old or older</p></li>
<li><p>alcohol: recoded as 0 (never used) 1 (used)</p></li>
</ul>
</div>
<div id="questions-about-drug-use" class="section level3">
<h3>Questions about drug use</h3>
<ul>
<li>Q30. Have you ever tried cigarette smoking, even one or two puffs?</li>
<li>Q50. During your life, how many times have you used any form of
cocaine, including powder, crack, or freebase?</li>
<li>Q51. During your life, how many times have you sniffed glue,
breathed the contents of aerosol spray cans, or inhaled any paints
or sprays to get high?</li>
<li>Q52. During your life, how many times have you used heroin (also
called smack, junk, or China White)?</li>
<li>Q53. During your life, how many times have you used methamphetamines
(also called speed, crystal meth, crank, ice, or meth)?</li>
<li>Q54. During your life, how many times have you used ecstasy (also
called MDMA)?</li>
<li>Q55. During your life, how many times have you taken steroid pills
or shots without a doctor’s prescription?</li>
<li>Q56. During your life, how many times have you used a needle to
inject any illegal drug into your body?</li>
<li>Q57. During the past 12 months, has anyone offered, sold, or given
you an illegal drug on school property?</li>
</ul>
</div>
</div>
</div>
